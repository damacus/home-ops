# yaml-language-server: $schema=https://raw.githubusercontent.com/bjw-s/helm-charts/app-template-3.1.0/charts/other/app-template/values.schema.json
---
controllers:
  fstrim:
    type: cronjob
    cronjob:
      schedule: "@weekly"
      parallelism: 3 # Set to my total number of nodes
      successfulJobsHistory: 1
      failedJobsHistory: 1
    containers:
      app:
        image:
          repository: ghcr.io/onedr0p/kubanetics
          tag: 2024.4.1@sha256:28addcaf03a83863d58e45ed98fc5339a24fec65900907beee38fe7fe8117bfe
        env:
          SCRIPT_NAME: fstrim.sh
        resources:
          requests:
            cpu: 25m
          limits:
            memory: 128Mi
        securityContext:
          privileged: true
    pod:
      hostNetwork: true
      hostPID: true
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: DoNotSchedule
          labelSelector:
            matchLabels:
              app.kubernetes.io/name: fstrim

persistence:
  procfs:
    type: hostPath
    hostPath: /proc
    hostPathType: Directory
    globalMounts:
      - path: /host/proc
        readOnly: true
  netfs:
    type: hostPath
    hostPath: /sys
    hostPathType: Directory
    globalMounts:
      - path: /host/net
        readOnly: true
