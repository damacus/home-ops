---
# MinIO Tenant Configuration
apiVersion: minio.min.io/v2
kind: Tenant
metadata:
  name: minio-tenant
  namespace: minio-tenant
spec:
  image: quay.io/minio/minio:RELEASE.2025-02-18T16-25-55Z@sha256:1df91be8d6a6146001cd6be2569a12785a8ece583b511f56ebed08f1e65d3611
  pools:
    - servers: 1
      name: pool-0
      volumesPerServer: 1
      volumeClaimTemplate:
        metadata:
          name: data
        spec:
          accessModes:
            - ReadWriteOnce
          resources:
            requests:
              storage: 1000Gi
          storageClassName: nfs-csi-ssd
  # Declarative bucket provisioning
  buckets:
    - name: app-data
      objectLock: false
      region: us-east-1
    - name: backups
      objectLock: true
      region: us-east-1
    - name: media
      objectLock: false
      region: us-east-1
  users:
    - name: storage-user
  configuration:
    name: minio-config
  mountPath: /export
  requestAutoCert: false
  serviceMetadata:
    minioServiceLabels:
      app: minio-tenant
    minioServiceAnnotations:
      io.cilium/lb-ipam-ips: "192.168.1.228"
  features:
    bucketDNS: false
    domains: {}
  env:
    - name: MINIO_PROMETHEUS_URL
      value: "http://kube-prometheus-stack-prometheus.monitoring:9090"
    - name: MINIO_PROMETHEUS_JOB_ID
      value: "minio-tenant"
    - name: MINIO_BROWSER_REDIRECT_URL
      value: "https://minio.ironstone.casa"
    - name: MINIO_PROMETHEUS_AUTH_TYPE
      value: "public"
    - name: MINIO_API_CORS_ALLOW_ORIGIN
      value: "https://minio.ironstone.casa,https://s3.ironstone.casa"
    - name: MINIO_AUTH_TYPE
      value: "public"
    - name: MINIO_UPDATE
      value: "off"
    - name: MINIO_API_REQUESTS_MAX
      value: "1600"
